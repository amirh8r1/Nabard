#!/usr/bin/env node

require("dotenv").config();
require("../server/ServerConfig")();

const http = require("http");
const https = require("https");

const ServerSSL = require("../server/ServerSSL");
const ServerLogger = require("../server/ServerLogger");
const ServerHelper = require("../server/ServerHelper");
const ServerBootstrap = require("../server/ServerBootstrap");

class ServerRunner {
  static run() {
    try {
      const app = ServerBootstrap.boot();

      if (process.env.SECURE_CONNECTIONS === "true") {
        const ports = ServerHelper.normalizePort(process.env.PORTS);

        const sslData = ServerSSL.getSSLData();

        ServerHelper.setup(app, ports);

        const servers = https.createServer(sslData, app);

        servers.listen(ports, () => {
          ServerLogger.info(process.env.URL);
          ServerLogger.info(`Secure connection is ON`);
          ServerLogger.info(`Server running on port ${ports}`);
        });
      } else {
        const port = ServerHelper.normalizePort(process.env.PORT);

        ServerHelper.setup(app, port);

        const server = http.createServer(app);

        server.listen(port, () => {
          ServerLogger.info(process.env.URL);
          ServerLogger.info(`Server running on port ${port}`);
        });
      }
    } catch (error) {
      ServerLogger.error(error);
    }
  }
}

ServerRunner.run();
